<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kxjl.tasktransferplat.dao.plus.OrderinfoMapper">
    <resultMap id="BaseResultMap" type="com.kxjl.tasktransferplat.pojo.Orderinfo">
        <id column="Id" jdbcType="VARCHAR" property="id"/>
        <result column="ProjectId" jdbcType="VARCHAR" property="projectId"/>
        <result column="OrderNo" jdbcType="VARCHAR" property="orderNo"/>
        <result column="OrderState" jdbcType="INTEGER" property="orderState"/>
        <result column="CreateTime" jdbcType="VARCHAR" property="createTime"/>
        <result column="CreateUserId" jdbcType="VARCHAR" property="createUserId"/>
        <result column="CreateRemark" jdbcType="VARCHAR" property="createRemark"/>
        <result column="PaymentType" jdbcType="INTEGER" property="paymentType"/>
        <result column="ServerType" jdbcType="INTEGER" property="serverType"/>
        <result column="LockNum" jdbcType="INTEGER" property="lockNum"/>
        <result column="AppointmentTime" jdbcType="VARCHAR" property="appointmentTime"/>
        <result column="LockerId" jdbcType="VARCHAR" property="lockerId"/>
        <result column="ReceiveTime" jdbcType="VARCHAR" property="receiveTime"/>
        <result column="DoneTime" jdbcType="VARCHAR" property="doneTime"/>
        <result column="AccountTime" jdbcType="VARCHAR" property="accountTime"/>
        <result column="LockerBasePrice" jdbcType="DECIMAL" property="lockerBasePrice"/>
        <result column="SellerId" jdbcType="VARCHAR" property="sellerId"/>
        <result column="SellerBasePrice" jdbcType="INTEGER" property="sellerBasePrice"/>
        <result column="SellerInnerId" jdbcType="VARCHAR" property="sellerInnerId"/>
        <result column="SellerInnerData" jdbcType="VARCHAR" property="sellerInnerData"/>
        <result column="LockerTotalPrice" jdbcType="DECIMAL" property="lockerTotalPrice"/>
        <result column="SellerTotalPrice" jdbcType="INTEGER" property="sellerTotalPrice"/>
        <result column="DataState" jdbcType="INTEGER" property="dataState"/>
        <result column="ServiceScore" jdbcType="INTEGER" property="serviceScore"/>
        <result column="CompanyId" jdbcType="VARCHAR" property="companyId"/>
        <result column="OrderType" jdbcType="VARCHAR" property="orderType"/>
        <result column="FinishRemark" jdbcType="VARCHAR" property="finishRemark"/>
        <result column="AddressDetail" jdbcType="VARCHAR" property="addressDetail"/>

        <result column="EnterpriseName" jdbcType="VARCHAR" property="EnterpriseName"/>

        <result column="EnterprisePhone" jdbcType="VARCHAR" property="EnterprisePhone"/>
        <result column="FinishedState" jdbcType="VARCHAR" property="finishedState"/>
        <result column="isRoomNessary" jdbcType="INTEGER" property="isRoomNessary"/>
        <result column="isUploadImei" jdbcType="INTEGER" property="isUploadImei"/>
        <result column="imeiNum" jdbcType="VARCHAR" property="imeiNum"/>


        <result column="productId" jdbcType="VARCHAR" property="productId"/>
        <result column="CustomerPhone2" jdbcType="VARCHAR" property="customerPhone2"/>
        <result column="urgent" jdbcType="VARCHAR" property="urgent"/>
        <result column="timeout" jdbcType="VARCHAR" property="timeout"/>
        <result column="ArravieTime" jdbcType="VARCHAR" property="arravieTime"/>
        <result column="MailAddressDetail" jdbcType="VARCHAR" property="mailAddressDetail"/>

        <result column="startimgs" jdbcType="VARCHAR" property="startimgs"/>
        <result column="icons" jdbcType="VARCHAR" property="icons"/>
        <result column="lockimgs" jdbcType="VARCHAR" property="lockimgs"/>
        <result column="doneimgs" jdbcType="VARCHAR" property="doneimgs"/>


        <result column="orderFeeType" jdbcType="VARCHAR" property="orderFeeType"/>

        <result column="deleteUseType" jdbcType="VARCHAR" property="deleteUseType"/>
        <result column="deleteReason" jdbcType="VARCHAR" property="deleteReason"/>


        <result column="installRemark" jdbcType="VARCHAR" property="installRemark"/>
        <result column="doorInfo" jdbcType="VARCHAR" property="doorInfo"/>
        
        <result column="orderComplateCode" jdbcType="VARCHAR" property="orderComplateCode"/>
           <result column="orderComplateCodeSend" jdbcType="VARCHAR" property="orderComplateCodeSend"/>
        


    </resultMap>
    <sql id="Base_Column_List">
        Id, ProjectId, OrderNo, OrderState, CreateTime, CreateUserId, CreateRemark, PaymentType,
        ServerType, LockNum, AppointmentTime, LockerId, ReceiveTime, DoneTime, AccountTime,
        LockerBasePrice, SellerId, SellerBasePrice, SellerInnerId, SellerInnerData, LockerTotalPrice,
        SellerTotalPrice, DataState, ServiceScore, CompanyId, OrderType, FinishRemark, CustomerName,
        customerPhone, addressDetail, isRoomNessary, isUploadImei,imeiNum,productId,customerPhone2,urgent
        timeout,arravieTime,mailAddressDetail,startimgs,icons,lockimgs,doneimgs,orderFeeType,deleteUseType
        ,deleteReason,installRemark,doorInfo,orderComplateCode,orderComplateCodeSend
    </sql>

    <sql id="my_column">
        id, projectId, orderNo, orderState, createTime, createUserId, createRemark, paymentType,
        serverType, lockNum, appointmentTime, lockerId, receiveTime, doneTime, accountTime,
        lockerBasePrice, sellerId, sellerBasePrice, sellerInnerId, sellerInnerData, lockerTotalPrice,
        sellerTotalPrice, dataState, serviceScore, companyId, orderType, finishRemark, customerName,
        customerPhone, addressDetail, areaCode, isRoomNessary, isUploadImei,imeiNum,productId,customerPhone2,urgent
        timeout,arravieTime,mailAddressDetail,startimgs,icons,lockimgs,doneimgs,orderFeeType,deleteUseType
        ,deleteReason,installRemark,doorInfo,orderComplateCode,orderComplateCodeSend
    </sql>
    <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from t_orderinfo
        where Id = #{id,jdbcType=VARCHAR}
    </select>

    <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
        DELETE FROM  t_orderinfo 
        WHERE Id = #{id,jdbcType=VARCHAR} AND DataState = 1
    </delete>

    <select id="selectByOrderNo" resultMap="BaseResultMap">
        SELECT *
        FROM t_orderinfo t
        left join t_locksmith_enterprise e on t.SellerId=e.Id
        WHERE t.OrderNo = #{orderNo}
    </select>

    <insert id="insertBatch">
        INSERT INTO t_orderinfo (Id, ProjectId, OrderNo,
        OrderState, CreateTime, CreateUserId,
        CreateRemark, PaymentType, ServerType,
        LockNum, AppointmentTime, LockerId,
        ReceiveTime, DoneTime, AccountTime,
        LockerBasePrice, SellerId, SellerBasePrice,
        SellerInnerId, SellerInnerData, LockerTotalPrice,
        SellerTotalPrice, DataState, ServiceScore,
        CompanyId, OrderType, CustomerName, CustomerPhone,
        AddressDetail, AreaCode, DistrictId, isRoomNessary,
        isUploadImei,imeiNum,productId,CustomerPhone2)
        VALUES
        <foreach collection="list" item="orderInfo" separator=",">
            (#{orderInfo.id,jdbcType=VARCHAR}, #{orderInfo.projectId,jdbcType=VARCHAR},
            #{orderInfo.orderNo,jdbcType=VARCHAR},
            #{orderInfo.orderState,jdbcType=INTEGER}, #{orderInfo.createTime,jdbcType=VARCHAR},
            #{orderInfo.createUserId,jdbcType=VARCHAR},
            #{orderInfo.createRemark,jdbcType=VARCHAR}, #{orderInfo.paymentType,jdbcType=INTEGER},
            #{orderInfo.serverType,jdbcType=INTEGER},
            #{orderInfo.lockNum,jdbcType=INTEGER}, #{orderInfo.appointmentTime,jdbcType=VARCHAR},
            #{orderInfo.lockerId,jdbcType=VARCHAR},
            #{orderInfo.receiveTime,jdbcType=VARCHAR}, #{orderInfo.doneTime,jdbcType=VARCHAR},
            #{orderInfo.accountTime,jdbcType=VARCHAR},
            #{orderInfo.lockerBasePrice,jdbcType=DECIMAL}, #{orderInfo.sellerId,jdbcType=VARCHAR},
            #{orderInfo.sellerBasePrice,jdbcType=INTEGER},
            #{orderInfo.sellerInnerId,jdbcType=VARCHAR}, #{orderInfo.sellerInnerData,jdbcType=VARCHAR},
            #{orderInfo.lockerTotalPrice,jdbcType=DECIMAL},
            #{orderInfo.sellerTotalPrice,jdbcType=INTEGER}, #{orderInfo.dataState,jdbcType=INTEGER},
            #{orderInfo.serviceScore,jdbcType=INTEGER},
            #{orderInfo.companyId,jdbcType=VARCHAR}, #{orderInfo.orderType,jdbcType=VARCHAR},
            #{orderInfo.customerName,jdbcType=VARCHAR}, #{orderInfo.customerPhone,jdbcType=VARCHAR},
            #{orderInfo.addressDetail,jdbcType=VARCHAR}, #{orderInfo.areaCode,jdbcType=VARCHAR},
            #{orderInfo.districtId,jdbcType=VARCHAR},#{orderInfo.isRoomNessary,jdbcType=INTEGER},
            #{orderInfo.isUploadImei,jdbcType=INTEGER},#{orderInfo.imeiNum,jdbcType=VARCHAR},
            #{orderInfo.productId,jdbcType=VARCHAR},#{orderInfo.customerPhone2,jdbcType=VARCHAR})
        </foreach>
    </insert>
    <insert id="insertSelective" parameterType="com.kxjl.tasktransferplat.pojo.Orderinfo">
        insert into t_orderinfo
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                Id,
            </if>
            <if test="projectId != null">
                ProjectId,
            </if>
            <if test="orderNo != null">
                OrderNo,
            </if>
            <if test="orderState != null">
                OrderState,
            </if>
            <if test="createTime != null">
                CreateTime,
            </if>
            <if test="createUserId != null">
                CreateUserId,
            </if>
            <if test="createRemark != null">
                CreateRemark,
            </if>
            <if test="paymentType != null">
                PaymentType,
            </if>
            <if test="serverType != null">
                ServerType,
            </if>
            <if test="lockNum != null">
                LockNum,
            </if>
            <if test="appointmentTime != null">
                AppointmentTime,
            </if>
            <if test="lockerId != null">
                LockerId,
            </if>
            <if test="receiveTime != null">
                ReceiveTime,
            </if>
            <if test="doneTime != null">
                DoneTime,
            </if>
            <if test="accountTime != null">
                AccountTime,
            </if>
            <if test="lockerBasePrice != null">
                LockerBasePrice,
            </if>
            <if test="sellerId != null">
                SellerId,
            </if>
            <if test="sellerBasePrice != null">
                SellerBasePrice,
            </if>
            <if test="sellerInnerId != null">
                SellerInnerId,
            </if>
            <if test="sellerInnerData != null">
                SellerInnerData,
            </if>
            <if test="lockerTotalPrice != null">
                LockerTotalPrice,
            </if>
            <if test="sellerTotalPrice != null">
                SellerTotalPrice,
            </if>
            <if test="dataState != null">
                DataState,
            </if>
            <if test="serviceScore != null">
                ServiceScore,
            </if>
            <if test="companyId != null">
                CompanyId,
            </if>
            <if test="orderType != null">
                OrderType,
            </if>
            <if test="finishRemark != null">
                FinishRemark,
            </if>
            <if test="isRoomNessary != null">
                isRoomNessary,
            </if>
            <if test="isUploadImei != null">
                isUploadImei,
            </if>
            <if test="imeiNum != null">
                imeiNum,
            </if>
            <if test="orderFeeType != null">
                orderFeeType,
            </if>
               <if test="orderComplateCode != null">
                orderComplateCode,
            </if>
               <if test="orderComplateCodeSend != null">
                orderComplateCodeSend,
            </if>
            

        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=VARCHAR},
            </if>
            <if test="projectId != null">
                #{projectId,jdbcType=VARCHAR},
            </if>
            <if test="orderNo != null">
                #{orderNo,jdbcType=VARCHAR},
            </if>
            <if test="orderState != null">
                #{orderState,jdbcType=INTEGER},
            </if>
            <if test="createTime != null">
                #{createTime,jdbcType=VARCHAR},
            </if>
            <if test="createUserId != null">
                #{createUserId,jdbcType=VARCHAR},
            </if>
            <if test="createRemark != null">
                #{createRemark,jdbcType=VARCHAR},
            </if>
            <if test="paymentType != null">
                #{paymentType,jdbcType=INTEGER},
            </if>
            <if test="serverType != null">
                #{serverType,jdbcType=INTEGER},
            </if>
            <if test="lockNum != null">
                #{lockNum,jdbcType=INTEGER},
            </if>
            <if test="appointmentTime != null">
                #{appointmentTime,jdbcType=VARCHAR},
            </if>
            <if test="lockerId != null">
                #{lockerId,jdbcType=VARCHAR},
            </if>
            <if test="receiveTime != null">
                #{receiveTime,jdbcType=VARCHAR},
            </if>
            <if test="doneTime != null">
                #{doneTime,jdbcType=VARCHAR},
            </if>
            <if test="accountTime != null">
                #{accountTime,jdbcType=VARCHAR},
            </if>
            <if test="lockerBasePrice != null">
                #{lockerBasePrice,jdbcType=DECIMAL},
            </if>
            <if test="sellerId != null">
                #{sellerId,jdbcType=VARCHAR},
            </if>
            <if test="sellerBasePrice != null">
                #{sellerBasePrice,jdbcType=INTEGER},
            </if>
            <if test="sellerInnerId != null">
                #{sellerInnerId,jdbcType=VARCHAR},
            </if>
            <if test="sellerInnerData != null">
                #{sellerInnerData,jdbcType=VARCHAR},
            </if>
            <if test="lockerTotalPrice != null">
                #{lockerTotalPrice,jdbcType=DECIMAL},
            </if>
            <if test="sellerTotalPrice != null">
                #{sellerTotalPrice,jdbcType=INTEGER},
            </if>
            <if test="dataState != null">
                #{dataState,jdbcType=INTEGER},
            </if>
            <if test="serviceScore != null">
                #{serviceScore,jdbcType=INTEGER},
            </if>
            <if test="companyId != null">
                #{companyId,jdbcType=VARCHAR},
            </if>
            <if test="orderType != null">
                #{orderType,jdbcType=VARCHAR},
            </if>
            <if test="finishRemark != null">
                #{finishRemark,jdbcType=VARCHAR},
            </if>
            <if test="isRoomNessary != null">
                #{isRoomNessary,jdbcType=INTEGER},
            </if>
            <if test="isUploadImei != null">
                #{isUploadImei,jdbcType=INTEGER},
            </if>
            <if test="imeiNum != null">
                #{imeiNum,jdbcType=VARCHAR},
            </if>
            <if test="orderFeeType != null">
                #{orderFeeType,jdbcType=VARCHAR},
            </if>
            
             <if test="orderComplateCode != null">
                #{orderComplateCode,jdbcType=VARCHAR},  
            </if>
            
              <if test="orderComplateCodeSend != null">
               #{orderComplateCodeSend,jdbcType=VARCHAR},   
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.kxjl.tasktransferplat.pojo.Orderinfo">
        update t_orderinfo
        <set>
            <if test="projectId != null">
                ProjectId = #{projectId,jdbcType=VARCHAR},
            </if>
            <if test="orderNo != null">
                OrderNo = #{orderNo,jdbcType=VARCHAR},
            </if>
            <if test="orderState != null">
                OrderState = #{orderState,jdbcType=INTEGER},
            </if>
            <if test="createTime != null">
                CreateTime = #{createTime,jdbcType=VARCHAR},
            </if>
            <if test="createUserId != null">
                CreateUserId = #{createUserId,jdbcType=VARCHAR},
            </if>
            <if test="createRemark != null">
                CreateRemark = #{createRemark,jdbcType=VARCHAR},
            </if>
            <if test="paymentType != null">
                PaymentType = #{paymentType,jdbcType=INTEGER},
            </if>
            <if test="serverType != null">
                ServerType = #{serverType,jdbcType=INTEGER},
            </if>
            <if test="lockNum != null">
                LockNum = #{lockNum,jdbcType=INTEGER},
            </if>
            <if test="appointmentTime != null">
                AppointmentTime = #{appointmentTime,jdbcType=VARCHAR},
            </if>
            <if test="lockerId != null">
                LockerId = #{lockerId,jdbcType=VARCHAR},
            </if>
            <if test="receiveTime != null">
                ReceiveTime = #{receiveTime,jdbcType=VARCHAR},
            </if>
            <if test="doneTime != null">
                DoneTime = #{doneTime,jdbcType=VARCHAR},
            </if>
            <if test="accountTime != null">
                AccountTime = #{accountTime,jdbcType=VARCHAR},
            </if>
            <if test="lockerBasePrice != null">
                LockerBasePrice = #{lockerBasePrice,jdbcType=DECIMAL},
            </if>
            <if test="sellerId != null">
                SellerId = #{sellerId,jdbcType=VARCHAR},
            </if>
            <if test="sellerBasePrice != null">
                SellerBasePrice = #{sellerBasePrice,jdbcType=INTEGER},
            </if>
            <if test="sellerInnerId != null">
                SellerInnerId = #{sellerInnerId,jdbcType=VARCHAR},
            </if>
            <if test="sellerInnerData != null">
                SellerInnerData = #{sellerInnerData,jdbcType=VARCHAR},
            </if>
            <if test="lockerTotalPrice != null">
                LockerTotalPrice = #{lockerTotalPrice,jdbcType=DECIMAL},
            </if>
            <if test="sellerTotalPrice != null">
                SellerTotalPrice = #{sellerTotalPrice,jdbcType=INTEGER},
            </if>
            <if test="dataState != null">
                DataState = #{dataState,jdbcType=INTEGER},
            </if>
            <if test="serviceScore != null">
                ServiceScore = #{serviceScore,jdbcType=INTEGER},
            </if>
            <if test="companyId != null">
                CompanyId = #{companyId,jdbcType=VARCHAR},
            </if>
            <if test="orderType != null">
                OrderType = #{orderType,jdbcType=VARCHAR},
            </if>
            <if test="finishRemark != null">
                FinishRemark = #{finishRemark,jdbcType=VARCHAR},
            </if>
            <if test="finishedState != null">
                FinishedState = #{finishedState,jdbcType=VARCHAR},
            </if>
            <if test="timeout != null">
                timeout = #{timeout,jdbcType=VARCHAR},
            </if>
            <if test="urgent != null">
                urgent = #{urgent,jdbcType=VARCHAR},
            </if>

            <if test="orderFeeType != null">
                orderFeeType= #{orderFeeType,jdbcType=VARCHAR},
            </if>
            <if test="deleteUseType != null">
                deleteUseType= #{deleteUseType,jdbcType=VARCHAR},
            </if>
            <if test="deleteReason != null">
                deleteReason= #{deleteReason,jdbcType=VARCHAR},
            </if>

            <if test="orderCashType != null">
                orderCashType= #{orderCashType,jdbcType=VARCHAR},
            </if>
            <if test="installRemark != null">
                installRemark= #{installRemark,jdbcType=VARCHAR},
            </if>
            <if test="doorInfo != null">
                doorInfo= #{doorInfo,jdbcType=VARCHAR},
            </if>
 			<if test="orderComplateCode != null">
               orderComplateCode= #{orderComplateCode,jdbcType=VARCHAR},  
            </if>
 <if test="orderComplateCodeSend != null">
             orderComplateCodeSend=  #{orderComplateCodeSend,jdbcType=VARCHAR},   
            </if>
        </set>
        where Id = #{id,jdbcType=VARCHAR}
    </update>


    <select id="selectList"
            resultMap="BaseResultMap"
            parameterType="com.kxjl.tasktransferplat.pojo.Orderinfo">
        select
        c.*,p.ProjectName projectName,u.Name lockName,locke.enterpriseName,locke.enterprisePhone
        from t_orderinfo c
        left join t_project p on c.ProjectId=p.Id
        left join t_userinfo u on c.LockerId=u.Id
        left join t_locksmith_enterprise locke on c.SellerId=locke.Id
        where 1=1 and c.DataState=1

        <if test=" id !=null and id !='' ">
            and c.id = #{id}
        </if>
        <if test=" projectName !=null and projectName !='' ">
            and p.ProjectName like concat ('%', #{projectName},'%')
        </if>
        <if test=" orderNo !=null and orderNo !='' ">
            and c.orderNo like concat ('%', #{orderNo},'%')
        </if>
        <if test=" serverTypeGet !=null and serverTypeGet !='' ">
            and c.ServerType like concat ('%',#{serverTypeGet},'%')
        </if>

        <if test=" enterpriseName !=null and enterpriseName !='' ">
            and locke.EnterpriseName like concat ('%', #{enterpriseName},'%')
        </if>

        <if test=" finishedState !=null and finishedState !='' ">
            and c.FinishedState =#{finishedState}
        </if>


        <if test="type == 0">
            <![CDATA[and (orderState >= 1 AND orderState < 99) ]]>
        </if>
        <if test="type == 1">
            <![CDATA[ and  orderState >= 101 AND orderState < 199 ]]>
        </if>
        <if test="type == 2">
            <![CDATA[ and (orderState >= 201 AND orderState < 399)  ]]>
        </if>
        <if test="type == 3">
            <![CDATA[   and  orderState >= 301 AND orderState < 399 ]]>
        </if>

        <if test="type == 4">
            <![CDATA[  and  orderState >= 401 AND orderState < 499 ]]>
        </if>
        <if test="type == 5">
            <![CDATA[  and  orderState >= 501 AND orderState < 599 ]]>
        </if>

    </select>


    <select id="selectPage" resultType="com.kxjl.tasktransferplat.pojo.Orderinfo">
        SELECT dpt.depositStatus,
        CONCAT(ap.ProvinceName,' ',c.CityName,' ',d.DistrictName) custAddress,o.*
        FROM t_orderinfo o
        left join t_area_district d on o.DistrictId=d.id
        left join t_area_city c on d.CityId=c.id
        left join t_area_province ap on c.ProvinceId=ap.id
        left join t_user_deposit dpt on (o.id=dpt.OrderInfoId  and dpt.DepositStatus=3)
        WHERE 1=1 and o.DataState=1
        <!--  <if test=" companyId !=null and companyId !='' ">
             and o.companyId = #{companyId}
         </if>
         <if test=" companyId ==null or  companyId =='' ">
             and o.companyId is null
         </if> -->

        <if test="type == 1">
            <![CDATA[
            AND orderState >= 101 AND orderState < 199
            ]]>
            <choose>
                <when test="userinfoJobAreaList != null and userinfoJobAreaList.size()>0">
                    AND o.DistrictId IN
                    <foreach collection="userinfoJobAreaList" item="item" index="index" open="(" close=")"
                             separator=",">
                        #{item.districtId,jdbcType=INTEGER}
                    </foreach>
                </when>
                <otherwise>
                    AND 1=0
                </otherwise>
            </choose>

        </if>
        <if test="type == 2">
            <![CDATA[ and ( (orderState >= 201 AND orderState < 299) OR (orderState >= 1 AND orderState < 99) )
            and o.LockerId = #{lockerId}
            order by o.AppointmentTime ASC , o.CreateTime ASC ]]>
        </if>
        <if test="type == 3">
            <![CDATA[   and  orderState >= 301 AND orderState < 599 and o.LockerId = #{lockerId}]]>
        </if>
    </select>

    <select id="selectDistributePage" resultType="com.kxjl.tasktransferplat.pojo.Orderinfo">
        SELECT
        CONCAT(ap.ProvinceName,' ',c.CityName,' ',d.DistrictName) custAddress,o.Id id,o.OrderNo orderNo,
        o.OrderState orderState,o.ServerType serverType,o.OrderType orderType,o.LockerTotalPrice lockerTotalPrice,
        o.AppointmentTime appointmentTime,userinfo.Name lockName
        FROM t_orderinfo o
        left JOIN t_userinfo userinfo on o.LockerId = userinfo.Id
        left join t_area_district d on o.DistrictId=d.id
        left join t_area_city c on d.CityId=c.id
        left join t_area_province ap on c.ProvinceId=ap.id
        WHERE 1=1 and o.DataState=1
        AND o.CompanyId = #{companyId} AND o.LockerId != #{companyId}
    </select>

    <!--工单详情-->
    <select id="selectorderinfoById" resultType="com.kxjl.tasktransferplat.pojo.Orderinfo">
        SELECT  dpt.depositStatus,
            CONCAT(ap.ProvinceName, ' ', c.CityName, ' ', d.DistrictName) custAddress,
            o.CustomerName                                                CustName,
            o.CustomerPhone                                               CustPhone,
            o.AddressDetail                                               custAddressDetail,
            o.*
        FROM t_orderinfo o
            LEFT JOIN t_area_district d ON o.DistrictId = d.id
            LEFT JOIN t_area_city c ON d.CityId = c.id
            LEFT JOIN t_area_province ap ON c.ProvinceId = ap.id
              left join t_user_deposit dpt on (o.id=dpt.OrderInfoId  and dpt.DepositStatus=3)
        WHERE 1 = 1 AND o.Id = #{orderId} 
    </select>


    <select id="selectListByComplete" resultType="com.kxjl.tasktransferplat.pojo.Orderinfo"
            resultMap="BaseResultMap">

        select
        c.*,(select sum(t1.ChangeValueLocker) from t_orderinfo_attach_money_detail t1 where
        t1.OrderinfoId=t.OrderinfoId) price,p.ProjectName projectName,u.Name lockName
        from t_orderinfo c
        left join t_orderinfo_attach_money_detail t on c.Id=t.OrderinfoId
        left join t_project p on c.ProjectId=p.Id
        left join t_userinfo u on c.LockerId=u.Id

        where c.OrderState between 500 and 600 and c.DataState=1
        <if test=" sellerId !=null and sellerId !='' ">
            and c.SellerId= #{sellerId}
        </if>
        <if test=" companyId !=null and companyId !='' ">
            and c.companyId = #{companyId}
        </if>
        <if test=" customerName !=null and customerName !='' ">
            and c.customerName like concat ('%', #{customerName},'%')
        </if>
        <if test=" customerPhone !=null and customerPhone !='' ">
            and c.CustomerPhone like concat ('%', #{customerPhone},'%')
        </if>
        <if test=" projectName !=null and projectName !='' ">
            and p.ProjectName like concat ('%', #{projectName},'%')
        </if>
        <if test=" orderNo !=null and orderNo !='' ">
            and c.orderNo like concat ('%', #{orderNo},'%')
        </if>
        <if test=" serverTypeGet !=null and serverTypeGet !='' ">
            and c.ServerType = #{serverTypeGet}
        </if>
        <if test=" createTime !=null and createTime !='' ">
            and date_format( c.CreateTime,'%Y-%m') = #{createTime}
        </if>
        <if test=" startTime !=null and startTime !='' ">
            and c.createTime >= #{startTime}
        </if>
        <if test=" endTime !=null and endTime !='' ">
            and c.createTime &lt; #{endTime}
        </if>
        <if test=" areaCode !=null and areaCode !='' ">
            and left(c.AreaCode, length(#{areaCode})) = #{areaCode}
        </if>
        GROUP BY c.orderNo
    </select>
    <select id="selectCountNum" resultType="java.lang.Integer">
        SELECT count(id)
        FROM  t_orderinfo 
        WHERE ProjectId = #{param1} AND DataState = 1
    </select>

    <select id="selectPointList" resultType="java.lang.Integer" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM t_orderinfo
        WHERE LockerId = #{id} AND DataState = 1
        ORDER BY CreateTime DESC
    </select>


    <update id="delete"
            parameterType="com.kxjl.tasktransferplat.pojo.Orderinfo">
        UPDATE  t_orderinfo 
        SET DataState = 2
        WHERE id = #{id,jdbcType=VARCHAR};

    </update>

    <select id="selectOrderStatusStasticList" resultType="com.kxjl.tasktransferplat.pojo.Orderinfo">

        select left(OrderState, 1) type ,date_format( t.CreateTime,'%Y-%m') month, count(*) num from t_orderinfo t where
        DataState=1 and OrderState>=100

        <if test=" companyId !=null and  companyId !='' ">
            and CompanyId = #{companyId}
        </if>


        <if test=" month!=null and month!='' ">
            and date_format( t.CreateTime,'%Y-%m') =#{month}
        </if>

        group by left(OrderState, 1)

        order by count(*) desc

    </select>
    <select id="selectAreaStatisticsList" resultType="com.kxjl.tasktransferplat.pojo.Orderinfo">
        select
        c.CityName custAddress,date_format( o.CreateTime,'%Y-%m') month,count(*)num
        from t_orderinfo o
        left join t_area_district d on o.DistrictId=d.id
        left join t_project p on o.ProjectId=p.Id
        left join t_area_city c on d.CityId=c.id
        where 1=1 and o.DataState=1


        <if test=" companyId !=null and  companyId !='' ">
            and o.SellerId is not null and o.SellerId = #{companyId}
        </if>

        <if test=" month!=null and month!='' ">
            and date_format( o.CreateTime,'%Y-%m') =#{month}
        </if>

        group by custAddress,date_format(o.CreateTime,'%Y-%m')

        order by count(*) desc

    </select>
    <select id="selectTypeStatisticsList" resultType="com.kxjl.tasktransferplat.pojo.Orderinfo">
        select ServerType serverType,date_format(CreateTime,'%Y-%m') month,count(*)num
        from t_orderinfo
        where 1=1 and DataState=1


        <if test=" companyId !=null and  companyId !='' ">
            and CompanyId is not null and CompanyId = #{companyId}
        </if>
        <if test=" companyId ==null or  companyId =='' ">
            and CompanyId is null
        </if>

        <if test=" month!=null and month!='' ">
            and date_format( CreateTime,'%Y-%m') =#{month}
        </if>

        group by ServerType,date_format(CreateTime,'%Y-%m')

        order by count(*) desc

    </select>
    <select id="selectTodoOrderInfoList" resultType="com.kxjl.tasktransferplat.pojo.Orderinfo">
        select
        *
        from t_orderinfo orderinfo

        where 1=1 and DataState=1
        <![CDATA[ and  orderState >= 101 AND orderState < 199 ]]>
        <if test=" orderNo !=null and orderNo !='' ">
            and c.OrderNo = #{orderNo}
        </if>

        <if test=" projectId !=null and projectId !='' ">
            and c.projectId = #{projectId}
        </if>

        <if test=" companyId !=null and companyId !='' ">
            and c.companyId = #{companyId}
        </if>
    </select>

    <select id="selectDoingOrderInfoList" resultType="com.kxjl.tasktransferplat.pojo.Orderinfo">
        select
        *
        from t_orderinfo orderinfo

        where 1=1 and orderinfo.DataState=1
        <![CDATA[ and (orderState >= 201 AND orderState < 299)]]>
        <if test=" orderNo !=null and orderNo !='' ">
            and orderinfo.OrderNo = #{orderNo}
        </if>

        <if test=" projectName !=null and projectName !='' ">
            and p.projectName = #{projectName}
        </if>

        <if test=" companyId !=null and companyId !='' ">
            and orderinfo.companyId = #{companyId}
        </if>
    </select>

    <select id="selectOrderInfoList" resultType="com.kxjl.tasktransferplat.pojo.Orderinfo">
        select
        orderinfo.CustomerName
        CustName,orderinfo.CustomerPhone CustPhone,orderinfo.AddressDetail custAddressDetail,orderinfo.*,

        p.ProjectName projectName, u.Name lockName, u.Phone lockerPhone, company.Name companyName,
        enterprise.EnterprisePhone,enterprise.EnterpriseName,
        area.areaName
        ,area.provinceId,area.cityId
        ,area.province,area.city,area.district,product.name productName, product.proType,product.lockType
        from t_orderinfo orderinfo

        -- left join (
        -- select province.provinceName province,city.cityName city,district.districtName district, province.id
        -- provinceId,city.id cityId,district.id districtId,
        -- concat(province.provinceName,city.cityName,district.districtName) areaName ,concat
        -- (province.provinceCode,city.cityCode,district.districtCode) areacode
        -- FROM t_area_province province
        -- LEFT JOIN t_area_city city ON city.provinceId = province.id
        -- LEFT JOIN t_area_district district ON district.cityId = city.id
        -- ) area on orderinfo.areacode=area.areacode

        left join cityall area on orderinfo.areacode=area.areacode


        LEFT JOIN t_project p ON p.Id = orderinfo.ProjectId
        LEFT JOIN t_userinfo u ON u.Id = orderinfo.LockerId

        left join t_userinfo company on company.id=orderinfo.companyid


        left join t_locksmith_enterprise enterprise on orderinfo.SellerId=enterprise.id

        left join t_lock_product_info product on product.id=orderinfo.productId

        where 1=1 and orderinfo.DataState!=2
        <if test=" dataState !=null ">
            and orderinfo.DataState =#{dataState}
        </if>
         <if test=" orderFeeType !=null and orderFeeType !='' ">
            and orderinfo.orderFeeType = #{orderFeeType}
        </if>
        

        <if test=" EnterprisePhone !=null and EnterprisePhone !='' ">
            and enterprise.EnterprisePhone like concat ('%', #{EnterprisePhone},'%')
        </if>
        <if test=" EnterpriseName !=null and EnterpriseName !='' ">
            and enterprise.EnterpriseName like concat ('%', #{EnterpriseName},'%')
        </if>


        <if test=" orderNo !=null and orderNo !='' ">
            and orderinfo.OrderNo LIKE concat ('%',#{orderNo},'%')
        </if>
        <if test=" id !=null and id !='' ">
            and orderinfo.id = #{id}
        </if>
        <if test=" customerName !=null and customerName !='' ">
            and orderinfo.customerName like concat ('%', #{customerName},'%')
        </if>
        <if test=" custPhone !=null and custPhone !='' ">
            and orderinfo.CustomerPhone like concat ('%', #{custPhone},'%')
        </if>
        <if test=" projectName !=null and projectName !='' ">
            and p.projectName like concat("%", #{projectName}, "%")
        </if>


        <if test=" serverTypeGet !=null and serverTypeGet !='' ">
            and orderinfo.ServerType like concat ('%',#{serverTypeGet},'%')
        </if>

        <if test=" lockerId !=null and lockerId !='' ">
            and orderinfo.LockerId = #{lockerId}
        </if>
        <if test=" lockerPhone !=null and lockerPhone !='' ">
            and u.phone like concat ('%', #{lockerPhone},'%')
        </if>
        <if test=" lockName !=null and lockName !='' ">
            and u.name like concat ('%', #{lockName},'%')
        </if>


        <if test=" provinceId !=null and provinceId !='' ">
            and area.provinceId = #{provinceId}
        </if>
        <if test=" cityId !=null and cityId !='' ">
            and area.cityId = #{cityId}
        </if>
        <if test=" districtId !=null and districtId !='' ">
            and area.districtId = #{districtId}
        </if>


        <!--    <if test=" companyId !=null and companyId !='' ">
               and orderinfo.companyId = #{companyId}
           </if> -->
        <if test=" createTime !=null and createTime !='' ">
            and date_format( orderinfo.CreateTime,'%Y-%m') = #{createTime}
        </if>
        <if test=" sellerId !=null and sellerId !='' ">
            and orderinfo.sellerId = #{sellerId}
        </if>
        <if test=" startTime !=null and startTime !='' ">
            and orderinfo.createTime >= #{startTime}
        </if>
        <if test=" endTime !=null and endTime !='' ">
            and orderinfo.createTime &lt; #{endTime}
        </if>
        <if test=" areaCode !=null and areaCode !='' ">
            and left(orderinfo.AreaCode, length(#{areaCode})) = #{areaCode}
        </if>
        <if test=" finishedState !=null and finishedState !='' or finishedState==0">
            and orderinfo.finishedState = #{finishedState}
        </if>
        <if test="type == 0">
            <![CDATA[ and orderState = 3 ]]>
        </if>
        <if test="type == 1">
            <![CDATA[ and  (orderState >= 101 AND orderState < 199) ]]>
        </if>
        <if test="type == 2">
            <![CDATA[ and ( ((orderState >= 201 AND orderState < 299) or (orderState >= 1 AND orderState < 99))   and orderState not in(1,2,3,4,5,6))  ]]>
        </if>
        <if test="type == 3">
            <![CDATA[   and  (orderState >= 301 AND orderState < 399) ]]>
        </if>

        <if test="type == 4">
            <![CDATA[  and  (orderState >= 401 AND orderState < 499) ]]>
        </if>
        <if test="type == 5">
            <![CDATA[  and  (orderState >= 501 AND orderState < 599) ]]>
        </if>
        <if test="type == 6">
            and orderState in(1,2,4,5,6)
        </if>
        <if test="type == 10">
            and orderState in(1,4,5)
        </if>
        
         <if test="type == 14">
            and orderState in(4)
        </if>
        order by orderState ASC, orderinfo.createTime DESC
    </select>


    <select id="selectOrderinfoByIdAndLockId" resultType="com.kxjl.tasktransferplat.pojo.Orderinfo">
        SELECT *
        FROM  t_orderinfo 
        WHERE id = #{param1} AND LockerId IS NOT NULL AND DataState = 1
    </select>
    <select id="selectCountAudit" resultType="java.lang.Integer">
        select count(*)num
        from t_orderinfo
        where 1=1 and DataState=1

        <if test=" companyId !=null and  companyId !='' ">
            and CompanyId = #{companyId}
        </if>

        <if test=" month!=null and month!='' ">
            and date_format( CreateTime,'%Y-%m') =#{month}
        </if>

        <if test="type == 2">
            <![CDATA[ and ((orderState >= 201 AND orderState < 299) or (orderState >= 1 AND orderState < 99))  ]]>
        </if>
    </select>
    <select id="selectStateCount" resultType="java.lang.Integer">
        select count(* ) num
        from t_orderinfo o
        where 1=1 and o.DataState=1
        <if test="type == 3">
            <![CDATA[   and  (orderState >= 301 AND orderState < 399) ]]>
        </if>
        <if test="type == 4">
            <![CDATA[  and  (orderState >= 401 AND orderState < 499) ]]>
        </if>
        <if test="type == 5">
            <![CDATA[  and  (orderState >= 501 AND orderState < 599) ]]>
        </if>
        <if test=" companyId !=null and companyId !='' ">
            and o.companyId= #{companyId}
        </if>

    </select>
    <select id="selectHuiFlockCount" resultType="java.util.Map">

        SELECT
        COUNT(1) AS orderNum,
        MONTH(o.ReceiveTime) as month,max(u.name)
        FROM
        t_orderinfo o
        left join t_userinfo u on u.id=o.lockerId
        left join t_company c on o.companyId=c.Id
        where DATE_FORMAT( o.ReceiveTime, '%Y%m' ) &lt;= DATE_FORMAT(now() , '%Y%m' ) and o.DataState=1
        <if test=" receiveTime !=null and receiveTime !='' ">
            and year(o.ReceiveTime)= #{receiveTime}
        </if>
        <if test="type == 4">
            <![CDATA[  and  (o.orderState >= 401 AND o.orderState < 599) ]]>
        </if>
        <if test=" companyId !=null and companyId !='' ">
            and o.companyId= #{companyId}
        </if>
        <if test=" lockerId !=null and lockerId !='' ">
            and o.lockerId= #{lockerId}
        </if>
        GROUP BY MONTH(o.ReceiveTime)
    </select>
    <select id="selectHuiFlockPassCount" resultType="java.util.Map">
        SELECT
        COUNT(1) AS orderNum,
        MONTH(o.DoneTime) as month
        FROM
        t_orderinfo o
        left join t_userinfo u on u.id=o.lockerId
        left join t_company c on o.companyId=c.Id
        where DATE_FORMAT( o.DoneTime, '%Y%m' ) &lt;= DATE_FORMAT(now() , '%Y%m' ) and o.DataState=1
        <if test=" doneTime !=null and doneTime !='' ">
            and year(o.DoneTime)= #{doneTime}
        </if>
        <if test="type == 4">
            <![CDATA[  and  (o.orderState >= 401 AND o.orderState < 599) ]]>
        </if>
        <if test=" companyId !=null and companyId !='' ">
            and o.companyId= #{companyId}
        </if>
        <if test=" lockerId !=null and lockerId !='' ">
            and o.lockerId= #{lockerId}
        </if>
        GROUP BY MONTH(o.DoneTime)
    </select>
    <select id="selectEnterpriseStatisticsList" resultType="java.util.Map">

        select date_format(CreateTime,'%Y-%m') as month,
        (select count(*) from t_orderinfo where date_format(CreateTime,'%Y-%m')= month and DataState=1 and
        FinishedState=0
        <if test=" sellerId !=null and sellerId !='' ">
            and SellerId= #{sellerId}
        </if>
        group by date_format(CreateTime,'%Y-%m'))num1,
        (select count(*) from t_orderinfo where date_format(CreateTime,'%Y-%m')= month and DataState=1 and
        FinishedState=1
        <if test=" sellerId !=null and sellerId !='' ">
            and SellerId= #{sellerId}
        </if>
        group by date_format(CreateTime,'%Y-%m'))num2,
        (select count(*) from t_orderinfo where date_format(CreateTime,'%Y-%m')= month and DataState=1 and OrderState
        <if test=" sellerId !=null and sellerId !='' ">
            and SellerId= #{sellerId}
        </if>
        group by date_format(CreateTime,'%Y-%m'))num3,
        (select sum(SellerTotalPrice) from t_orderinfo where date_format(CreateTime,'%Y-%m')= month and DataState=1 and
        FinishedState=1
        <if test=" sellerId !=null and sellerId !='' ">
            and SellerId= #{sellerId}
        </if>
        group by date_format(CreateTime,'%Y-%m'))num4

        from t_orderinfo
        where 1=1 and DataState=1
        <if test=" createTime !=null and createTime !='' ">
            and date_format( CreateTime,'%Y') = #{createTime}
        </if>

        <if test=" sellerId !=null and sellerId !='' ">
            and SellerId= #{sellerId}
        </if>
        group by date_format(CreateTime,'%Y-%m')

        order by date_format(CreateTime,'%Y-%m')


    </select>
    <select id="selectCompanyStatisticsList" resultType="java.util.Map">
        select date_format(CreateTime,'%Y-%m') as month,
        (select count(*) from t_orderinfo where date_format(CreateTime,'%Y-%m')= month and DataState=1 and OrderState
        between 400 and 499
        <if test=" companyId !=null and companyId !='' ">
            and CompanyId= #{companyId}
        </if>
        group by date_format(CreateTime,'%Y-%m'))num1,
        (select count(*) from t_orderinfo where date_format(CreateTime,'%Y-%m')= month and DataState=1 and OrderState
        between 500 and 599
        <if test=" companyId !=null and companyId !='' ">
            and CompanyId= #{companyId}
        </if>
        group by date_format(CreateTime,'%Y-%m'))num2,
        (select count(*) from t_orderinfo where date_format(CreateTime,'%Y-%m')= month and DataState=1 and OrderState
        <if test=" companyId !=null and companyId !='' ">
            and CompanyId= #{companyId}
        </if>
        group by date_format(CreateTime,'%Y-%m'))num3,
        (select sum(LockerTotalPrice) from t_orderinfo where date_format(CreateTime,'%Y-%m')= month and DataState=1 and
        OrderState
        between 500 and 599
        <if test=" companyId !=null and companyId !='' ">
            and CompanyId= #{companyId}
        </if>
        group by date_format(CreateTime,'%Y-%m'))num4

        from t_orderinfo
        where 1=1 and DataState=1
        <if test=" createTime !=null and createTime !='' ">
            and date_format( CreateTime,'%Y') = #{createTime}
        </if>
        <if test=" companyId !=null and companyId !='' ">
            and CompanyId= #{companyId}
        </if>
        group by date_format(CreateTime,'%Y-%m')

        order by date_format(CreateTime,'%Y-%m')
    </select>
    <select id="selectCountCompany" resultType="java.lang.Integer">
        select count(*)
        from t_orderinfo
        where 1=1 and DataState=1
        <if test=" companyId !=null and companyId !='' ">
            and CompanyId= #{companyId}
        </if>
        <if test="type == 1">
            <![CDATA[ and  (orderState >= 101 AND orderState < 199) ]]>
        </if>

    </select>
    <select id="selectAllocatedList" resultType="java.util.Map">
        select count(*)num,u.`Name`
        from t_orderinfo o
        inner join t_userinfo u on o.LockerId=u.Id
        where 1=1 and o.DataState=1
        <if test=" month !=null and month !='' ">
            and date_format( o.CreateTime,'%Y-%m') = #{month}
        </if>
        <if test=" companyId !=null and companyId !='' ">
            and o.CompanyId= #{companyId}
        </if>


        group by u.`Name`

        order by count(*) desc
    </select>
    <select id="selectStateList" resultType="java.util.Map">
        select count(*)num,u.`Name`
        from t_orderinfo o
        left join t_userinfo u on o.LockerId=u.Id
        where 1=1 and o.DataState=1
        <if test=" month !=null and month !='' ">
            and date_format( o.CreateTime,'%Y-%m') = #{month}
        </if>
        <if test=" companyId !=null and companyId !='' ">
            and o.CompanyId= #{companyId}
        </if>

        <if test="type == 4">
            <![CDATA[  and  (orderState >= 401 AND orderState < 499) ]]>
        </if>
        <if test="type == 5">
            <![CDATA[  and  (orderState >= 501 AND orderState < 599) ]]>
        </if>
        group by u.`Name`

        order by count(*) desc
    </select>


    <select id="selectPartnerFinancialStasticList" resultType="java.util.Map">
        SELECT t_company.`Id`,t_company.`CompanyName`,t_company.`Province`,t_company.`City`,t_company.`AreaCode`,
        SUM(orderinfo.LockerTotalPrice) totalPrice,COUNT(orderinfo.`Id`) countNum,date_format(
        orderInfo.DoneTime,'%Y-%m') month
        FROM t_company, t_orderinfo orderinfo
        WHERE 1=1 AND t_company.`Id`=orderinfo.`CompanyId`
        AND orderinfo.`OrderState`>=501 AND orderinfo.`OrderState` &lt;= 599
        <if test=" month!=null and month!='' ">
            and date_format( orderInfo.DoneTime,'%Y-%m') =#{month}
        </if>
        GROUP BY t_company.Id ORDER BY COUNT(orderinfo.`Id`),t_company.`CompanyName` DESC
    </select>
    <select id="selectNoPartnerFinancialStasticList" resultType="java.util.Map">
        select
        concat(province.ProvinceName,city.CityName) custAddress,date_format( orderInfo.DoneTime,'%Y-%m')
        month,count(*) num,
        SUM(orderinfo.LockerTotalPrice) totalPrice
        from t_orderinfo orderInfo
        left join t_area_district district on orderInfo.DistrictId=district.id
        left join t_project project on orderInfo.ProjectId=project.Id
        left join t_area_city city on district.CityId=city.id
        left join t_area_province province on city.ProvinceId=province.id
        where 1=1 and orderInfo.DataState=1
        and orderInfo.CompanyId is null
        AND orderInfo.OrderState>=501 AND orderInfo.OrderState &lt; 599
        <if test=" month!=null and month!='' ">
            and date_format( orderInfo.DoneTime,'%Y-%m') =#{month}
        </if>
        group by custAddress,date_format(orderInfo.DoneTime,'%Y-%m')
        order by count(*) desc
    </select>
    <select id="selectLockCompanyFinancialStatisticsList" resultType="java.util.Map">
        SELECT
        lockSmith.`Id`,
        lockSmith.`EnterpriseName` enterpriseName,
        lockSmith.`EnterprisePhone` enterprisePhone,
        SUM(orderinfo.LockerTotalPrice) totalPrice,
        COUNT(orderinfo.`Id`) countNum,
        date_format(orderInfo.DoneTime, '%Y-%m') month
        FROM t_locksmith_enterprise lockSmith, t_orderinfo orderInfo
        WHERE lockSmith.`Id` = orderInfo.`SellerId`
        AND orderinfo.`OrderState` >= 501 AND orderinfo.`OrderState` &lt;= 599
        <if test=" month!=null and month!='' ">
            and date_format( orderInfo.DoneTime,'%Y-%m') =#{month}
        </if>
        GROUP BY lockSmith.Id
        ORDER BY COUNT(orderinfo.`Id`) DESC
    </select>
    <select id="selectOrderInfoLists" resultType="com.kxjl.tasktransferplat.pojo.Orderinfo">
        select
        CONCAT(province.ProvinceName,' ',city.CityName,' ',district.DistrictName) areaName,orderinfo.CustomerName
        CustName,orderinfo.CustomerPhone CustPhone,orderinfo.AddressDetail custAddressDetail,orderinfo.*,
        p.ProjectName projectName, u.Name lockName, u.Phone lockerPhone, company.CompanyName
        companyName,locke.enterpriseName,locke.enterprisePhone
        from t_orderinfo orderinfo
        LEFT JOIN t_area_district district ON orderinfo.districtId = district.id
        LEFT JOIN t_area_city city ON district.cityId = city.id
        LEFT JOIN t_area_province province ON city.provinceId = province.id
        LEFT JOIN t_project p ON p.Id = orderinfo.ProjectId
        LEFT JOIN t_userinfo u ON u.Id = orderinfo.LockerId
        LEFT JOIN t_company company ON orderinfo.CompanyId = company.Id
        left join t_locksmith_enterprise locke on orderinfo.SellerId=locke.Id
        where 1=1 and orderinfo.DataState=1
        <if test=" orderNo !=null and orderNo !='' ">
            and orderinfo.OrderNo LIKE concat ('%',#{orderNo},'%')
        </if>
        <if test=" id !=null and id !='' ">
            and orderinfo.id = #{id}
        </if>
        <if test=" customerName !=null and customerName !='' ">
            and orderinfo.customerName like concat ('%', #{customerName},'%')
        </if>
        <if test=" custPhone !=null and custPhone !='' ">
            and orderinfo.CustomerPhone like concat ('%', #{custPhone},'%')
        </if>
        <if test=" projectName !=null and projectName !='' ">
            and p.projectName like concat("%", #{projectName}, "%")
        </if>

        <if test=" enterpriseName !=null and enterpriseName !='' ">
            and locke.EnterpriseName like concat ('%', #{enterpriseName},'%')
        </if>


        <if test=" serverTypeGet !=null and serverTypeGet !='' ">
            and orderinfo.ServerType like concat ('%',#{serverTypeGet},'%')
        </if>

        <if test=" companyId !=null and companyId !='' ">
            and orderinfo.companyId = #{companyId}
        </if>
        <if test=" createTime !=null and createTime !='' ">
            and date_format( orderinfo.CreateTime,'%Y-%m') = #{createTime}
        </if>
        <if test=" sellerId !=null and sellerId !='' ">
            and orderinfo.sellerId = #{sellerId}
        </if>
        <if test=" startTime !=null and startTime !='' ">
            and orderinfo.createTime >= #{startTime}
        </if>
        <if test=" endTime !=null and endTime !='' ">
            and orderinfo.createTime &lt; #{endTime}
        </if>
        <if test=" areaCode !=null and areaCode !='' ">
            and left(orderinfo.AreaCode, length(#{areaCode})) = #{areaCode}
        </if>
        <if test=" finishedState !=null and finishedState !='' or finishedState==0">
            and orderinfo.finishedState = #{finishedState}
        </if>
        <![CDATA[  and  (orderState >= 401 AND orderState < 599) ]]>
        order by orderinfo.orderState>400 DESC , orderinfo.finishedState ASC
    </select>
    <insert id="insertByParamMap" parameterType="java.util.Map">
        INSERT INTO t_orderinfo (
            `id`,
            `orderNo`,
            `serverType`,
            `lockNum`,
            `createRemark`,
            `createUserId`,
            `appointmentTime`,
            `customerName`,
            `customerPhone`,
            `addressDetail`,
            `areaCode`
        )
        VALUES
            (
                #{id,jdbcType=VARCHAR},
                #{orderNo,jdbcType=VARCHAR},
                #{serverType,jdbcType=INTEGER},
                #{lockNum,jdbcType=INTEGER},
                #{createRemark,jdbcType=VARCHAR},
                #{createUserId,jdbcType=VARCHAR},
                #{appointmentTime,jdbcType=TIMESTAMP},
                #{customerName,jdbcType=VARCHAR},
                #{customerPhone,jdbcType=VARCHAR},
                #{addressDetail,jdbcType=VARCHAR},
                #{areaCode,jdbcType=VARCHAR}
            )
    </insert>


    <select id="selectLockerUnFinishOrder" resultType="com.kxjl.tasktransferplat.pojo.Orderinfo"
            parameterType="java.lang.Long">
        SELECT t.*
        FROM t_orderinfo t
        WHERE 1=1 AND t.DataState = 1
        AND t.OrderState &lt;= 499
        and t.LockerId=#{lockerId}
    </select>


    <select id="selectPartnerUnFinishOrderCount" resultType="java.lang.Integer" parameterType="java.lang.Long">
        SELECT COUNT(*)
        FROM  t_orderinfo 
        WHERE 1=1 AND  t_orderinfo .DataState = 1
        AND  t_orderinfo .CompanyId = #{companyId,jdbcType=VARCHAR}
        AND  t_orderinfo .OrderState &lt;= 499
    </select>

    <select id="selecLockCompanyUnFinishOrderCount" resultType="java.lang.Integer" parameterType="java.lang.Long">
        SELECT COUNT(*)
        FROM  t_orderinfo 
        WHERE 1=1 AND  t_orderinfo .DataState = 1
        AND  t_orderinfo .SellerId = #{sellerId,jdbcType=VARCHAR}
        AND  t_orderinfo .OrderState &lt;= 499
    </select>
    <select id="selectAddPrice" resultType="com.kxjl.tasktransferplat.pojo.Orderinfo">
        select
        orderinfo.Id,(select sum(t1.ChangeValueLocker) from t_orderinfo_attach_money_detail t1 where
        t1.OrderinfoId=t.OrderinfoId) price
        from t_orderinfo orderinfo
        left join t_orderinfo_attach_money_detail t on orderinfo.Id=t.OrderinfoId

    </select>


    <select id="selectALLList"
            resultType="com.kxjl.tasktransferplat.pojo.Orderinfo"
            parameterType="com.kxjl.tasktransferplat.pojo.Orderinfo">

        select * from (
        select distinct
        CONCAT(province.ProvinceName,' ',city.CityName,' ',district.DistrictName) areaName,orderinfo.CustomerName
        CustName,orderinfo.CustomerPhone CustPhone,orderinfo.AddressDetail custAddressDetail,orderinfo.*,
        p.ProjectName projectName, u.Name lockName, u.Phone lockerPhone, company.name
        companyName,locke.enterpriseName,locke.enterprisePhone ,max(log.OperateTime) lastOperateTime
        from t_orderinfo orderinfo
        LEFT JOIN t_area_district district ON orderinfo.districtId = district.id
        LEFT JOIN t_area_city city ON district.cityId = city.id
        LEFT JOIN t_area_province province ON city.provinceId = province.id
        LEFT JOIN t_project p ON p.Id = orderinfo.ProjectId
        LEFT JOIN t_userinfo u ON u.Id = orderinfo.LockerId
        left join t_userinfo company on company.id=orderinfo.companyid

        left join t_locksmith_enterprise locke on orderinfo.SellerId=locke.Id

        left join t_orderinfo_operate_log log on orderinfo.id=log.OrderInfoId
        where 1=1 and orderinfo.DataState=1
        <if test=" orderNo !=null and orderNo !='' ">
            and orderinfo.OrderNo LIKE concat ('%',#{orderNo},'%')
        </if>
        
              <if test=" orderFeeType !=null and orderFeeType !='' ">
            and orderinfo.orderFeeType = #{orderFeeType}
        </if>
        
        <if test=" id !=null and id !='' ">
            and orderinfo.id = #{id}
        </if>
        <if test=" customerName !=null and customerName !='' ">
            and orderinfo.customerName like concat ('%', #{customerName},'%')
        </if>
        <if test=" custPhone !=null and custPhone !='' ">
            and orderinfo.CustomerPhone like concat ('%', #{custPhone},'%')
        </if>
        <if test=" projectName !=null and projectName !='' ">
            and p.projectName like concat("%", #{projectName}, "%")
        </if>

        <if test=" enterpriseName !=null and enterpriseName !='' ">
            and locke.EnterpriseName like concat ('%', #{enterpriseName},'%')
        </if>


        <if test=" serverTypeGet !=null and serverTypeGet !='' ">
            and orderinfo.ServerType like concat ('%',#{serverTypeGet},'%')
        </if>

        <if test=" companyId !=null and companyId !='' ">
            and orderinfo.companyId = #{companyId}
        </if>
        <if test=" createTime !=null and createTime !='' ">
            and date_format( orderinfo.CreateTime,'%Y-%m') = #{createTime}
        </if>
        <if test=" sellerId !=null and sellerId !='' ">
            and orderinfo.sellerId = #{sellerId}
        </if>
        <if test=" startTime !=null and startTime !='' ">
            and orderinfo.createTime >= #{startTime}
        </if>
        <if test=" endTime !=null and endTime !='' ">
            and orderinfo.createTime &lt; #{endTime}
        </if>
        <if test=" areaCode !=null and areaCode !='' ">
            and left(orderinfo.AreaCode, length(#{areaCode})) = #{areaCode}
        </if>
        <if test=" finishedState !=null and finishedState !='' or finishedState==0">
            and orderinfo.finishedState = #{finishedState}
        </if>
        <if test="type == 0">
            <![CDATA[ and orderState = 3 ]]>
        </if>
        <if test="type == 1">
            <![CDATA[ and  (orderState >= 101 AND orderState < 199) ]]>
        </if>
        <if test="type == 2">
            <![CDATA[ and ((orderState >= 201 AND orderState < 299) or (orderState >= 1 AND orderState < 99) AND orderState != 3)  ]]>
        </if>
        <if test="type == 3">
            <![CDATA[   and  (orderState >= 301 AND orderState < 399) ]]>
        </if>

        <if test="type == 4">
            <![CDATA[  and  (orderState >= 401 AND orderState < 499) ]]>
        </if>
        <if test="type == 5">
            <![CDATA[  and  (orderState >= 501 AND orderState < 599) ]]>
        </if>


        <if test=" operlogType !=null and operlogType !=''  ">
            and log.Type= #{operlogType}
        </if>
        <if test=" choice !=null and choice !=''  ">
            and (log.Type =0 and log.SubType=1) or (log.Type =1 and log.SubType=0)
        </if>
        <if test=" operlogSubType !=null and operlogSubType !='' ">
            and log.SubType= #{operlogSubType}
        </if>

        <if test=" logstartTime !=null and logstartTime !='' ">
            and log.OperateTime >= #{logstartTime}
        </if>
        <if test=" logendTime !=null and logendTime !='' ">
            and log.OperateTime &lt; #{logendTime}
        </if>

        <if test=" operateUserId !=null and operateUserId !='' ">
            and log.operateUserId = #{operateUserId}
        </if>
         <if test=" lockerId !=null and lockerId !='' ">
            and orderinfo.LockerId = #{lockerId}
        </if>
        <if test=" lockerPhone !=null and lockerPhone !='' ">
            and u.phone like concat ('%', #{lockerPhone},'%')
        </if>
        <if test=" lockName !=null and lockName !='' ">
            and u.name like concat ('%', #{lockName},'%')
        </if>


        group by orderinfo.id

        ) tt order by tt.createTime desc


    </select>

    <update id="updateOrderParterNull">
        UPDATE  t_orderinfo 
        SET CompanyId = NULL
        WHERE id = #{id};

    </update>

    <update id="updateOrderLockerNull">
        UPDATE  t_orderinfo 
        SET LockerId = NULL
        WHERE id = #{id};

    </update>

    <select id="selectListByWithdraw" resultType="java.util.Map">
        select
        c.Id,c.orderNo,c.serverType,c.lockerBasePrice,date_format(c.DoneTime,'%Y-%m-%d %H:%i') DoneTime,
        c.lockerTotalPrice,u.Name lockName,q.serviceState moneyQuestionState,
        CONCAT(province.ProvinceName,' ',city.CityName,' ',district.DistrictName) custAddress
        from t_orderinfo c
        left join t_userinfo u on c.LockerId=u.Id
        left join t_orderinfo_money_question q on c.Id=q.orderInfoId
        LEFT JOIN t_user_deposit d ON c.Id = d.OrderInfoId
        left join t_area_district district on c.DistrictId=district.id
        left join t_area_city city on district.CityId=city.id
        left join t_area_province province on city.ProvinceId=province.id

        WHERE c.OrderState BETWEEN 500 AND 600 AND c.DataState=1
        and(
        (c.orderCashType=0  AND c.LockerId=#{userId})
        OR (c.orderCashType =1 AND c.LockerId=#{userId} <![CDATA[AND TIMESTAMPDIFF(DAY ,c.AccountTime,now())>=7]]>)
        OR (c.orderCashType=2 AND c.LockerId=#{userId} AND c.CompanyId is null <![CDATA[AND date_format(c.AccountTime,'%Y-%m')<date_format(now(),'%Y-%m')]]>)
        OR (c.orderCashType=2 AND c.CompanyId=#{userId} <![CDATA[AND date_format(c.AccountTime,'%Y-%m')<date_format(now(),'%Y-%m')]]>)
        )
        <if test=" (orderNo !=null and orderNo !='') or (name !=null and name !='') or (phone !=null and phone !='') ">
        AND
        (<if test=" orderNo !=null and orderNo !='' ">
          c.OrderNo like concat ('%', #{orderNo},'%') OR
        </if>
         <if test=" name !=null and name !='' ">
         u.Name like concat ('%', #{name},'%') OR
         </if>
         <if test=" phone !=null and phone !='' ">
          u.Phone like concat ('%', #{phone},'%')
          </if>
          )
          </if>
          AND NOT EXISTS (SELECT * FROM t_user_deposit WHERE c.Id = t_user_deposit.OrderInfoId)
        <if test=" doneTime !=null and doneTime !='' ">
            <![CDATA[AND date_format(c.AccountTime,'%Y-%m')= #{doneTime}]]>
        </if>
        ORDER BY c.DoneTime
    </select>

    <select id="selectMobileListByWithdraw" resultType="java.util.Map">
        select
        c.Id,c.orderNo,c.serverType,c.lockerBasePrice,date_format(c.DoneTime,'%Y-%m-%d %H:%i') DoneTime,
        c.lockerTotalPrice,u.Name lockName,q.serviceState moneyQuestionState,
        CONCAT(province.ProvinceName,' ',city.CityName,' ',district.DistrictName) custAddress
        from t_orderinfo c
        left join t_userinfo u on c.LockerId=u.Id
        left join t_orderinfo_money_question q on c.Id=q.orderInfoId
        LEFT JOIN t_user_deposit d ON c.Id = d.OrderInfoId
        left join t_area_district district on c.DistrictId=district.id
        left join t_area_city city on district.CityId=city.id
        left join t_area_province province on city.ProvinceId=province.id

        WHERE c.OrderState BETWEEN 500 AND 600 AND c.DataState=1

        and(
        (c.orderCashType=0  AND c.LockerId=#{userId})
        OR (c.orderCashType =1 AND c.LockerId=#{userId} <![CDATA[AND TIMESTAMPDIFF(DAY ,c.AccountTime,now())>=7]]>)
        OR (c.orderCashType=2 AND c.LockerId=#{userId} AND c.CompanyId is null <![CDATA[AND date_format(c.AccountTime,'%Y-%m')<date_format(now(),'%Y-%m')]]>)
        OR (c.orderCashType=2 AND c.CompanyId=#{userId} <![CDATA[AND date_format(c.AccountTime,'%Y-%m')<date_format(now(),'%Y-%m')]]>)
        )
        <if test=" (orderNo !=null and orderNo !='') or (name !=null and name !='') or (phone !=null and phone !='') ">
            AND (
            <if test=" orderNo !=null and orderNo !='' ">
                c.OrderNo like concat ('%', #{orderNo},'%') OR
            </if>
            <if test=" name !=null and name !='' ">
                u.Name like concat ('%', #{name},'%') OR
            </if>
            <if test=" phone !=null and phone !='' ">
                u.Phone like concat ('%', #{phone},'%')
            </if>
            )
        </if>
        AND NOT EXISTS (SELECT * FROM t_user_deposit WHERE c.Id = t_user_deposit.OrderInfoId)
        <if test=" doneTime !=null and doneTime !='' ">
            <![CDATA[AND date_format(c.AccountTime,'%Y-%m')= #{doneTime}]]>
        </if>
        ORDER BY c.DoneTime
    </select>

                  <select id="selectTotalMoneyByWithdraw" resultType="java.lang.Object">
                      select
                      sum(c.LockerTotalPrice) totalPrice
                      from t_orderinfo c
                      left join t_userinfo u on c.LockerId=u.Id
                      left join t_orderinfo_money_question q on c.Id=q.orderInfoId
                      LEFT JOIN t_user_deposit d ON c.Id = d.OrderInfoId
                      left join t_area_district district on c.DistrictId=district.id
                      left join t_area_city city on district.CityId=city.id
                      left join t_area_province province on city.ProvinceId=province.id

                      WHERE c.OrderState BETWEEN 500 AND 600 AND c.DataState=1

                      and(
                      (c.orderCashType=0  AND c.LockerId=#{userId})
                      OR (c.orderCashType =1 AND c.LockerId=#{userId} <![CDATA[AND TIMESTAMPDIFF(DAY ,c.AccountTime,now())>=7]]>)
                      OR (c.orderCashType=2 AND c.LockerId=#{userId} AND c.CompanyId is null <![CDATA[AND date_format(c.AccountTime,'%Y-%m')<date_format(now(),'%Y-%m')]]>)
                      OR (c.orderCashType=2 AND c.CompanyId=#{userId} <![CDATA[AND date_format(c.AccountTime,'%Y-%m')<date_format(now(),'%Y-%m')]]>)
                      )
                      <if test=" (orderNo !=null and orderNo !='') or (name !=null and name !='') or (phone !=null and phone !='') ">
                          AND (
                          <if test=" orderNo !=null and orderNo !='' ">
                              c.OrderNo like concat ('%', #{orderNo},'%') OR
                          </if>
                          <if test=" name !=null and name !='' ">
                              u.Name like concat ('%', #{name},'%') OR
                          </if>
                          <if test=" phone !=null and phone !='' ">
                              u.Phone like concat ('%', #{phone},'%')
                          </if>
                          )
                      </if>
                      AND NOT EXISTS (SELECT * FROM t_user_deposit WHERE c.Id = t_user_deposit.OrderInfoId)
                      <if test=" doneTime !=null and doneTime !='' ">
                          <![CDATA[AND date_format(c.AccountTime,'%Y-%m')= #{doneTime}]]>
                      </if>
                      <if test=" auditOrderFlag !=null and auditOrderFlag !=''">
                      <![CDATA[AND (q.serviceState != 0 OR q.serviceState IS null)]]>
                      </if>
                      ORDER BY c.DoneTime
                  </select>

    <select id="selectLockerSmithEnterpriseFinancialList" resultType="java.util.Map">
        select orderinfo.orderFeeType, locksmith.EnterpriseName enterpriseName,orderinfo.lockNum num,
        orderinfo.Id id,orderinfo.OrderNo orderNo,orderinfo.ServerType serverType,
        locksmith.EnterpriseName enterpriseName,
        date_format(orderinfo.CreateTime,'%Y-%m-%d %H:%i') createTime,
        date_format(orderinfo.DoneTime,'%Y-%m-%d %H:%i') doneTime,orderinfo.CustomerName customerName,
        orderinfo.CustomerPhone,customerPhone,
        CONCAT(province.ProvinceName,' ',city.CityName,' ',district.DistrictName) custAddress,
        orderinfo.SellerTotalPrice sellerTotalPrice,moneyDetail.*
        from t_orderinfo orderinfo
        left join t_area_district district on orderinfo.DistrictId=district.id
        left join t_area_city city on district.CityId=city.id
        left join t_area_province province on city.ProvinceId=province.id
        LEFT JOIN t_locksmith_enterprise locksmith on orderinfo.SellerId=locksmith.Id
        LEFT JOIN
        (SELECT OrderinfoId,
        SUM(CASE ReasonType WHEN '10' THEN ChangeValueSeller ELSE NULL END) 'build',
        SUM(CASE ReasonType WHEN '11' THEN ChangeValueSeller ELSE NULL END) 'repair',
        SUM(CASE ReasonType WHEN '12' THEN ChangeValueSeller ELSE NULL END) 'openLock',
        SUM(CASE ReasonType WHEN '14' THEN ChangeValueSeller ELSE NULL END) 'measure',
        SUM(CASE ReasonType WHEN '15' THEN ChangeValueSeller ELSE NULL END) 'catInstall',
        SUM(CASE ReasonType WHEN '16' THEN ChangeValueSeller ELSE NULL END) 'changeLock',
        SUM(CASE ReasonType WHEN '17' THEN ChangeValueSeller ELSE NULL END) 'projectBuild',
        SUM(CASE ReasonType WHEN '18' THEN ChangeValueSeller ELSE NULL END) 'projectRepair',
         SUM(CASE ReasonType WHEN '119' THEN ChangeValueSeller ELSE NULL END) 'projectOther',
        SUM(CASE ReasonType WHEN '19' THEN ChangeValueSeller ELSE NULL END) 'buildOther',

        SUM(CASE ReasonType WHEN '21' THEN ChangeValueSeller ELSE NULL END) 'runEmpty',
        SUM(CASE ReasonType WHEN '22' THEN ChangeValueSeller ELSE NULL END) 'longDistance',
        SUM(CASE ReasonType WHEN '23' THEN ChangeValueSeller ELSE NULL END) 'changeBuild',
        SUM(CASE ReasonType WHEN '24' THEN ChangeValueSeller ELSE NULL END) 'specialDoor',
        SUM(CASE ReasonType WHEN '25' THEN ChangeValueSeller ELSE NULL END) 'hurry',
        
        SUM(CASE ReasonType WHEN '26' THEN ChangeValueSeller ELSE NULL END) 'prelock'

        FROM t_orderinfo_attach_money_detail
        GROUP BY OrderinfoId) moneyDetail ON orderinfo.Id = moneyDetail.OrderinfoId
        where 1=1 and orderinfo.DataState=1
        <if test=" orderNo !=null and orderNo !='' ">
            and orderinfo.OrderNo LIKE concat ('%',#{orderNo},'%')
        </if>
        <if test=" id !=null and id !='' ">
            and orderinfo.id = #{id}
        </if>
        <if test=" customerName !=null and customerName !='' ">
            and orderinfo.customerName like concat ('%', #{customerName},'%')
        </if>
        <if test=" custPhone !=null and custPhone !='' ">
            and orderinfo.CustomerPhone like concat ('%', #{custPhone},'%')
        </if>
        <if test=" enterpriseName !=null and enterpriseName !='' ">
            and locksmith.EnterpriseName like concat ('%', #{enterpriseName},'%')
        </if>
        <if test=" serverTypeGet !=null and serverTypeGet !='' ">
            and orderinfo.ServerType like concat ('%',#{serverTypeGet},'%')
        </if>

        <if test=" companyId !=null and companyId !='' ">
            and orderinfo.companyId = #{companyId}
        </if>
        <if test=" createTime !=null and createTime !='' ">
            and date_format( orderinfo.CreateTime,'%Y-%m') = #{createTime}
        </if>
        <if test=" sellerId !=null and sellerId !='' ">
            and orderinfo.sellerId = #{sellerId}
        </if>
        <if test=" startTime !=null and startTime !='' ">
            and orderinfo.createTime >= #{startTime}
        </if>
        <if test=" endTime !=null and endTime !='' ">
            and orderinfo.createTime &lt; #{endTime}
        </if>
        <if test=" areaCode !=null and areaCode !='' ">
            and left(orderinfo.AreaCode, length(#{areaCode})) = #{areaCode}
        </if>
        <if test=" finishedState !=null and finishedState !='' or finishedState==0">
            and orderinfo.finishedState = #{finishedState}
        </if>
        <![CDATA[  and  (orderState >= 401 AND orderState < 599) ]]>
        order by orderinfo.orderState>400 DESC , orderinfo.finishedState ASC,locksmith.id
    </select>
</mapper>